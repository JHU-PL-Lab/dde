(library
 (name interpreter)
 (public_name dde.interpreter)
 (preprocess
  (pps ppx_deriving.show bisect_ppx ppx_jane))
 (instrumentation
  (backend bisect_ppx --bisect-file _build/bisect))
 (modules fbdk debugutils version ast type interp lexer options parser pp)
 (libraries core))

(ocamllex
 (modules lexer))

(menhir
 (modules parser))

(executable
 (name main)
 (modes byte)
 (modules main)
 (libraries interpreter))

(toplevel
 (name toplevel)
 (libraries utop interpreter))

(alias
 (name distributables)
 (deps main.bc toplevel.exe))

(rule
 (target version.ml)
 (deps (universe))
 (action
  (progn
   (run chmod +x %{project_root}/scripts/gen_version.sh)
   (run %{project_root}/scripts/gen_version.sh))))
